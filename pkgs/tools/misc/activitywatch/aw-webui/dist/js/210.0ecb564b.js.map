{"version":3,"file":"js/210.0ecb564b.js","mappings":"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","sources":["webpack://aw-webui/./src/views/Trends.vue?89b1","webpack://aw-webui/src/views/Trends.vue","webpack://aw-webui/./src/views/Trends.vue?36a4","webpack://aw-webui/./src/views/Trends.vue","webpack://aw-webui/./src/util/datasets.ts","webpack://aw-webui/./node_modules/@babel/runtime/helpers/esm/arrayWithoutHoles.js","webpack://aw-webui/./node_modules/@babel/runtime/helpers/esm/iterableToArray.js","webpack://aw-webui/./node_modules/@babel/runtime/helpers/esm/nonIterableSpread.js","webpack://aw-webui/./node_modules/@babel/runtime/helpers/esm/toConsumableArray.js"],"sourcesContent":["var render = function () {var _vm=this;var _h=_vm.$createElement;var _c=_vm._self._c||_h;return _c('div',[_c('h3',{staticClass:\"mb-0\"},[_vm._v(\"Trends for \"+_vm._s(_vm._f(\"friendlyperiod\")(_vm.timeperiod)))]),_c('b-input-group',{attrs:{\"size\":\"sm\"}},[_c('b-form-select',{attrs:{\"label\":\"Host\",\"options\":_vm.$store.getters['buckets/hosts'],\"placeholder\":\"Select a hostname\"},model:{value:(_vm.host),callback:function ($$v) {_vm.host=$$v},expression:\"host\"}})],1),_c('div',{staticClass:\"mb-2\"},[_c('ul',{staticClass:\"list-group list-group-horizontal-md mb-3\",staticStyle:{\"font-size\":\"0.9em\",\"opacity\":\"0.7\"}},[_c('li',{staticClass:\"list-group-item pl-0 pr-3 py-0\",staticStyle:{\"border\":\"0\"}},[_c('b',[_vm._v(\"Host:\")]),_vm._v(\" \"+_vm._s(_vm.host))])])]),_c('b-alert',{staticStyle:{},attrs:{\"show\":\"\"}},[_vm._v(\"This feature is still in early development.\")]),_c('div',[_c('aw-timeline-barchart',{attrs:{\"datasets\":_vm.datasets,\"height\":100}})],1),_c('div',[_c('hr'),_c('h5',[_vm._v(\"Options\")]),_c('aw-devonly',[_c('b-btn',{attrs:{\"id\":\"load-demo\"},on:{\"click\":_vm.load_demo}},[_vm._v(\"Load demo data\")])],1)],1)],1)}\nvar staticRenderFns = []\n\nexport { render, staticRenderFns }","<!--\n\n  NOTE: This file was copied from Activity.vue, could probably be refactored into something a lot better with less code duplication.\n\n-->\n\n<template lang=\"pug\">\ndiv\n  h3.mb-0 Trends for {{ timeperiod | friendlyperiod }}\n\n  // Select a hostname from the ones available in the store\n  b-input-group(size=\"sm\")\n    b-form-select(\n      v-model=\"host\"\n      label=\"Host\"\n      :options=\"$store.getters['buckets/hosts']\"\n      placeholder=\"Select a hostname\")\n\n  div.mb-2\n    ul.list-group.list-group-horizontal-md.mb-3(style=\"font-size: 0.9em; opacity: 0.7\")\n      li.list-group-item.pl-0.pr-3.py-0(style=\"border: 0\")\n        | #[b Host:] {{ host }}\n\n  b-alert(style=\"warning\" show)\n    | This feature is still in early development.\n\n  div\n    aw-timeline-barchart(:datasets=\"datasets\" :height=\"100\")\n\n  div\n    hr\n    h5 Options\n\n    // TODO: Refactor options from Activity into component and reuse here\n\n    aw-devonly\n      b-btn(id=\"load-demo\", @click=\"load_demo\")\n        | Load demo data\n</template>\n\n<style lang=\"scss\" scoped></style>\n\n<script>\nimport moment from 'moment';\nimport { get_today_with_offset } from '~/util/time';\n\nimport { buildBarchartDataset } from '~/util/datasets';\n\nexport default {\n  name: 'Trends',\n  props: {},\n  data: function () {\n    const offset = this.$store.state.settings.startOfDay;\n    const today = get_today_with_offset(offset);\n    const n_days = 7;\n    const since = moment(today).subtract(n_days, 'days');\n    return {\n      today,\n      timeperiod: { start: since, length: [n_days, 'day'] },\n    };\n  },\n\n  computed: {\n    host() {\n      return this.$route.params.host;\n    },\n    datasets: function () {\n      return buildBarchartDataset(\n        this.$store,\n        this.$store.state.activity.category.by_period,\n        this.$store.state.activity.active.events,\n        this.$store.state.categories.classes\n      );\n    },\n  },\n\n  mounted: async function () {\n    this.$store.dispatch('categories/load');\n    await this.refresh();\n  },\n\n  methods: {\n    refresh: async function (force) {\n      const queryParams = {\n        timeperiod: this.timeperiod,\n        host: this.host,\n        force: force,\n        filterAFK: this.filterAFK,\n        includeAudible: this.includeAudible,\n        filterCategories: this.filterCategories,\n        dontQueryInactive: false,\n      };\n      //await this.$store.dispatch('activity/ensure_loaded', queryParams);\n      await this.$store.dispatch('activity/query_category_time_by_period', queryParams);\n    },\n\n    load_demo: async function () {\n      this.data = { '2021-01': 1000, '2021-02': 500 };\n    },\n  },\n};\n</script>\n","import mod from \"-!../../node_modules/thread-loader/dist/cjs.js!../../node_modules/babel-loader/lib/index.js??clonedRuleSet-37[0].rules[0].use[1]!../../node_modules/@vue/vue-loader-v15/lib/index.js??vue-loader-options!./Trends.vue?vue&type=script&lang=js&\"; export default mod; export * from \"-!../../node_modules/thread-loader/dist/cjs.js!../../node_modules/babel-loader/lib/index.js??clonedRuleSet-37[0].rules[0].use[1]!../../node_modules/@vue/vue-loader-v15/lib/index.js??vue-loader-options!./Trends.vue?vue&type=script&lang=js&\"","import { render, staticRenderFns } from \"./Trends.vue?vue&type=template&id=3294fe02&scoped=true&lang=pug&\"\nimport script from \"./Trends.vue?vue&type=script&lang=js&\"\nexport * from \"./Trends.vue?vue&type=script&lang=js&\"\n\n\n/* normalize component */\nimport normalizer from \"!../../node_modules/@vue/vue-loader-v15/lib/runtime/componentNormalizer.js\"\nvar component = normalizer(\n  script,\n  render,\n  staticRenderFns,\n  false,\n  null,\n  \"3294fe02\",\n  null\n  \n)\n\nexport default component.exports","import _ from 'lodash';\n\nimport { split_by_hour_into_data } from '~/util/transforms';\nimport { getColorFromCategory } from '~/util/color';\nimport { Category } from '~/util/classes';\nimport { IEvent } from './interfaces';\n\ninterface HourlyData {\n  cat_events: IEvent[];\n}\n\ninterface Dataset {\n  label: string;\n  backgroundColor: string;\n  data: number[];\n}\n\nexport function buildBarchartDataset(\n  $store: any,\n  data_by_hour: HourlyData[],\n  classes: Category[]\n): Dataset[] {\n  const SEP = '>>>';\n  const data = data_by_hour;\n  if (data) {\n    const category_names: Set<string> = new Set(\n      Object.values(data)\n        .map(result => {\n          return result.cat_events.map(e => e.data['$category'].join(SEP));\n        })\n        .flat()\n    );\n    const ds: Dataset[] = [...category_names]\n      .map(c_ => {\n        const c = $store.getters['categories/get_category'](c_.split(SEP));\n        if (c) {\n          const values = Object.values(data).map(results => {\n            const cat = results.cat_events.find(e => _.isEqual(e.data['$category'], c.name));\n            if (cat) return Math.round((cat.duration / (60 * 60)) * 1000) / 1000;\n            else return null;\n          });\n          return {\n            label: c.name.join(' > '),\n            backgroundColor: getColorFromCategory(c, classes),\n            data: values,\n          } as Dataset;\n        } else {\n          // FIXME: This shouldn't happen\n          // This may for example happen if one doesn't have an 'Uncategorized' category,\n          // as can happen when one upgrades from an old version where there wasn't one in the default classes.\n          console.error('missing category:', c_);\n        }\n      })\n      .filter(x => x);\n    return ds;\n  } else {\n    return [];\n  }\n}\n\nexport function buildBarchartDatasetActive($store: any, events_active: IEvent[]) {\n  const data = split_by_hour_into_data(events_active);\n  return [\n    {\n      label: 'Total time',\n      backgroundColor: '#6699ff',\n      data,\n    },\n  ];\n}\n","import arrayLikeToArray from \"./arrayLikeToArray.js\";\nexport default function _arrayWithoutHoles(arr) {\n  if (Array.isArray(arr)) return arrayLikeToArray(arr);\n}","export default function _iterableToArray(iter) {\n  if (typeof Symbol !== \"undefined\" && iter[Symbol.iterator] != null || iter[\"@@iterator\"] != null) return Array.from(iter);\n}","export default function _nonIterableSpread() {\n  throw new TypeError(\"Invalid attempt to spread non-iterable instance.\\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.\");\n}","import arrayWithoutHoles from \"./arrayWithoutHoles.js\";\nimport iterableToArray from \"./iterableToArray.js\";\nimport unsupportedIterableToArray from \"./unsupportedIterableToArray.js\";\nimport nonIterableSpread from \"./nonIterableSpread.js\";\nexport default function _toConsumableArray(arr) {\n  return arrayWithoutHoles(arr) || iterableToArray(arr) || unsupportedIterableToArray(arr) || nonIterableSpread();\n}"],"names":["render","_vm","this","_h","$createElement","_c","_self","staticClass","_v","_s","_f","timeperiod","attrs","$store","getters","model","value","callback","$$v","host","expression","staticStyle","datasets","on","load_demo","staticRenderFns","name","props","data","today","start","length","computed","$route","params","mounted","methods","refresh","queryParams","force","filterAFK","includeAudible","filterCategories","dontQueryInactive","component","buildBarchartDataset","data_by_hour","classes","SEP","category_names","Set","Object","values","map","result","cat_events","e","join","flat","ds","c_","c","split","results","cat","find","Math","round","duration","label","backgroundColor","getColorFromCategory","console","error","filter","x","_arrayWithoutHoles","arr","Array","isArray","arrayLikeToArray","_iterableToArray","iter","Symbol","iterator","from","_nonIterableSpread","TypeError","_toConsumableArray","arrayWithoutHoles","iterableToArray","unsupportedIterableToArray","nonIterableSpread"],"sourceRoot":""}